<!doctype html>
<html lang="en" xmlns:th="https://www.thymeleaf.com">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="./css/ViewClasses.css">
    <link rel="stylesheet" href="./css/searchForm.css">
    <script src="https://kit.fontawesome.com/0faddc1af8.js" crossorigin="anonymous"></script>
</head>
<body>
    <!--  NAVBAR    -->
    <nav>
      <div class="wrapper">
        <!-- LOGO ADMIN -->
        <div class="logo"><a href="/Admin_Menu">Admin Menu</a></div>
  
        <input type="radio" name="slider" id="menu-btn">
        <input type="radio" name="slider" id="close-btn">
        <ul class="nav-links">
          <label for="close-btn" class="btn close-btn"><i class="fas fa-times"></i></label>
          <!-- NAVBAR - HOME -->
          <li><a href="/Admin_Menu">Home</a></li>
  
          <!-- NAVBAR - PLAY -->
          <li><a href="/Admin_Play">Gioca</a></li>
  
          <!-- NAVBAR - GAME MENU -->
          <li><a href="#" class="desktop-item">Game Menu</a>
            <input type="checkbox" id="showDrop">
            <label for="showDrop" class="mobile-item">Game Menu</label>
            <ul class="drop-menu">
              <li><a href="/Admin_ViewClasses">View Classes</a></li>
              <li><a href="/Admin_SearchClasses">Search Classes</a></li>
            </ul>
          </li>
  
          <!-- NAVBAR - GAME MANAGEMENT -->
          <li><a href="#" class="desktop-item">Game Management</a>
            <input type="checkbox" id="showMega">
            <label for="showMega" class="mobile-item">Game Management</label>
            <div class="mega-box">
              <div class="content">
                <div class="row">
                  <img src="https://www.gameindustrycareerguide.com/wp-content/uploads/2021/05/best-programming-languages-for-games.jpg" alt="">
                </div>
                <div class="row">
                  <header>Class Management</header>
                  <ul class="mega-links">
                    <li><a href="/Admin_UploadClass">Upload Class</a></li>
                    <li><a href="/Admin_ManageClass">Manage Classes</a></li>
                    <li><a href="/Admin_AdvancedSearchClasses">Search Classes</a></li>
                  </ul>
                </div>
                <div class="row">
                  <header>User Management</header>
                  <ul class="mega-links">
                    <li><a href="#">Register an User</a></li>
                    <li><a href="#">Delete an User</a></li>
                    <li><a href="#">Search an User</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </li>
          <li><a href="/">Esci</a></li>
        </ul>
        <label for="menu-btn" class="btn menu-btn"><i class="fas fa-bars"></i></label>
      </div>
    </nav>

  <!--    CONTENUTO DELLA PAGINA  -->
<div class="container">
    <div class="text"> Admin Advanced Search </div>
    <form id="searchForm">
        <div class="form-row">
            <div class="subText" style="width:800px; margin:0 auto;">LOC:</div>
            <div class="input-data">
                <input type="number" id="loc" name="loc">
            </div>
        </div>
        <div class="form-row" >
            <div class="subText" style="width:800px; margin:0 auto;">Complexity:</div>
            <div class="input-data">
                <select id="complexity" name="complexity">
                    <option selected value="" >Any</option>
                    <option value="SIMPLE">Simple</option>
                    <option value="MODERATE">Moderate</option>
                    <option value="COMPLEX">Complex</option>
                    <option value="INSANE">Insane</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="subText" style="width:800px; margin:0 auto;">Recommended:</div>
            <div class="input-data">
                <select id="recommended" name="recommended">
                    <option value="">Any</option>
                    <option value="RANDOOP">Randoop</option>
                    <option value="EVOSUITE">EvoSuite</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="subText" style="width:800px; margin:0 auto;">Last Update:</div>
            <div class="input-data">
                <input type="date" id="lastUpdate" name="lastUpdate">
            </div> 
        </div>
        <div class="form-row submit-btn">
            <div class="input-data" style="width:800px; margin:0 auto;">
               <div class="inner"></div>
               <input type="submit" value="       submit">
            </div>
        </div>
    </form>
</div>

<div>
    <table class="table table-striped table-hover mt-4">
        <thead>
        <tr>
            <th scope="col" style="color: #fff;">ID</th>
            <th scope="col" style="color: #fff;">Url</th>
            <th scope="col" style="color: #fff;">Complexity</th>
            <th scope="col" style="color: #fff;">LOC</th>
            <th scope="col" id="lastupdate" style="color: #fff;">Last Update</th>
            <th scope="col" style="color: #fff;">Opponent Recommended</th>
            <th scope="col" style="color: #fff;">File ID</th>
            <th scope="col" style="color: #fff;">Actions</th>
        </tr>
        </thead>
        <tbody id="classTableBody">
        </tbody>
    </table>
</div>

<!--    SCRIPT DELLA RICERCA    -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const searchForm = document.getElementById('searchForm');
const classTableBody = document.getElementById('classTableBody');

searchForm.addEventListener('submit', function(event) {
    event.preventDefault();

    const loc = document.getElementById('loc').value;
    const complexity = document.getElementById('complexity').value || null;
    const lastUpdate = document.getElementById('lastUpdate').value || null;
    const recommended = document.getElementById('recommended').value || null;

    const params = new URLSearchParams();
    params.append('loc', loc);
    if (complexity !== null) params.append('complexity', complexity);
    if (lastUpdate !== null) params.append('lastUpdate', lastUpdate);
    if (recommended !== null) params.append('recommended', recommended);

    axios.get('/user/api/RicercaAvanzata?' + params)
        .then(function(response) {
            const classes = response.data;

            classTableBody.innerHTML = '';

            for (const classObj of classes) {
                const row = document.createElement('tr');

                const idCell = document.createElement('td');
                idCell.textContent = classObj.id;
                row.appendChild(idCell);

                const urlCell = document.createElement('td');
                urlCell.textContent = classObj.url;
                row.appendChild(urlCell);

                const complexityCell = document.createElement('td');
                complexityCell.textContent = classObj.complexity;
                row.appendChild(complexityCell);

                const locCell = document.createElement('td');
                locCell.textContent = classObj.loc;
                row.appendChild(locCell);

				const lastUpdateCell = document.createElement('td');
				lastUpdateCell.textContent = classObj.lastupdate || '';
				row.appendChild(lastUpdateCell);
				
				const recommendedCell = document.createElement('td');
				recommendedCell.textContent = classObj.recommended;
				row.appendChild(recommendedCell);
				
				const fileIdCell = document.createElement('td');
				fileIdCell.textContent = classObj.fileId || '';
				row.appendChild(fileIdCell);


                const actionsCell = document.createElement('td');
                const downloadLink = document.createElement('a');
                downloadLink.setAttribute('class', 'btn btn-secondary btn-sm');
                downloadLink.setAttribute('href', '/user/downloadFile/' + classObj.fileId);
                downloadLink.textContent = 'Download';

                const deleteLink = document.createElement('a');
                deleteLink.setAttribute('class', 'delete-icon ms-3');
                deleteLink.setAttribute('style', 'color: red');
                deleteLink.setAttribute('href', '/Admin_EliminaClasse/' + classObj.id);
                const deleteIcon = document.createElement('i');
                deleteIcon.setAttribute('class', 'fa-solid fa-trash');
                deleteLink.appendChild(deleteIcon);

                const updateLink = document.createElement('a');
                updateLink.setAttribute('class', 'update-icon ms-3');
                updateLink.setAttribute('style', 'color: blue');
                updateLink.setAttribute('href', '/Admin_UpdateClasses/' + classObj.id);
                const updateIcon = document.createElement('i');
                updateIcon.setAttribute('class', 'fa-solid fa-pencil');
                updateLink.appendChild(updateIcon);

                actionsCell.appendChild(deleteLink);
                actionsCell.appendChild(updateLink);
                actionsCell.appendChild(downloadLink);
                
                row.appendChild(actionsCell);

                classTableBody.appendChild(row);
            }
        })
        .catch(function(error) {
            console.error(error);
        });
});
</script>
</body>
  