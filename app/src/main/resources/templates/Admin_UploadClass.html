<!doctype html>
<html lang="en" xmlns:th="https://www.thymeleaf.com">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="../css/ViewClasses.css">
    <link rel="stylesheet" href="../css/searchForm.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
</head>
<body>
  <!--  NAVBAR    -->
  <nav>
    <div class="wrapper">
      <!-- LOGO ADMIN -->
      <div class="logo"><a href="/Admin_Menu">Admin Menu</a></div>

      <input type="radio" name="slider" id="menu-btn">
      <input type="radio" name="slider" id="close-btn">
      <ul class="nav-links">
        <label for="close-btn" class="btn close-btn"><i class="fas fa-times"></i></label>
        <!-- NAVBAR - HOME -->
        <li><a href="/Admin_Menu">Home</a></li>

        <!-- NAVBAR - PLAY -->
        <li><a href="/Admin_Play">Gioca</a></li>

        <!-- NAVBAR - GAME MENU -->
        <li><a href="#" class="desktop-item">Game Menu</a>
          <input type="checkbox" id="showDrop">
          <label for="showDrop" class="mobile-item">Game Menu</label>
          <ul class="drop-menu">
            <li><a href="/Admin_ViewClasses">View Classes</a></li>
            <li><a href="/Admin_SearchClasses">Search Classes</a></li>
          </ul>
        </li>

        <!-- NAVBAR - GAME MANAGEMENT -->
        <li><a href="#" class="desktop-item">Game Management</a>
          <input type="checkbox" id="showMega">
          <label for="showMega" class="mobile-item">Game Management</label>
          <div class="mega-box">
            <div class="content">
              <div class="row">
                <img src="https://www.gameindustrycareerguide.com/wp-content/uploads/2021/05/best-programming-languages-for-games.jpg" alt="">
              </div>
              <div class="row">
                <header>Class Management</header>
                <ul class="mega-links">
                  <li><a href="/Admin_UploadClass">Upload Class</a></li>
                  <li><a href="/Admin_ManageClass">Manage Classes</a></li>
                  <li><a href="/Admin_AdvancedSearchClasses">Search Classes</a></li>
                </ul>
              </div>
              <div class="row">
                <header>User Management</header>
                <ul class="mega-links">
                  <li><a href="#">Register an User</a></li>
                  <li><a href="#">Delete an User</a></li>
                  <li><a href="#">Search an User</a></li>
                </ul>
              </div>
            </div>
          </div>
        </li>
        <li><a href="/">Esci</a></li>
      </ul>
      <label for="menu-btn" class="btn menu-btn"><i class="fas fa-bars"></i></label>
    </div>
  </nav>

<!--    CONTENUTO DELLA PAGINA  -->
<div class="container">
    <div class="alert alert-url-exist-error" style="display: none;">Url already exist</div>
    <div class="alert alert-loc-zero-error" style="display: none;">Insert Loc greater than zero!</div>
	<div class="alert alert-date-nonValid-error" style="display: none;">Insert a valid Last Update</div>
    <div class="alert alert-success">File uploaded successfully</div>
    <div class="alert alert-danger">File is not uploaded. Error occurred</div>

    <div class="text">Upload Class</div>
    <form method="POST" enctype="multipart/form-data" id="fileUploadForm">
        <div class="form-row">
            <div class="subText" style="width:800px; margin:0 auto;">LOC:</div>
            <div class="input-data">
                <input type="number" class="form-control" id="loc" name="loc" required>
            </div>
        </div>
        <div class="form-row" >
            <div class="subText" style="width:800px; margin:0 auto;">Complexity:</div>
            <div class="input-data">
                <select id="complexity" name="complexity" required>
                    <option selected value="" >Any</option>
                    <option value="SIMPLE">Simple</option>
                    <option value="MODERATE">Moderate</option>
                    <option value="COMPLEX">Complex</option>
                    <option value="INSANE">Insane</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="subText" style="width:800px; margin:0 auto;">Last Update:</div>
            <div class="input-data">
                <input type="date" id="lastupdate" name="lastupdate" required>
            </div> 
        </div>

        <div class="form-row">
            <div class="subText" style="width:800px; margin:0 auto;">Opponent Recommended:</div>
            <div class="input-data">
                <select id="recommended" name="recommended">
                    <option value="">Any</option>
                    <option value="RANDOOP">Randoop</option>
                    <option value="EVOSUITE">EvoSuite</option>
                </select>
            </div>
        </div>

        
        <div class="upload">
            <input type="file" name="file">
        </div>
        

        <div class="form-row submit-btn">
            <div class="input-data" style="width:800px; margin:0 auto;">
               <div class="inner"></div>
               <input type="submit" value="       submit" class="form-submit-button" id="btnSubmit">
            </div>
        </div>
    </form>
</div>


<script>

    $(document).ready(function () {

        $(".alert-success").hide();
        $(".alert-danger").hide();
        $("#btnSubmit").click(function () {
            var form = $('#fileUploadForm')[0];
            var data = new FormData(form);



            var jsonDataObj = {

                "complexity": $("#complexity").val(),

                "loc": $("#loc").val(),

                "lastupdate": $("#lastupdate").val(),

                "recommended": $("#recommended").val()

            };

            data.append("jsondata", JSON.stringify(jsonDataObj));



            $("#btnSubmit").prop("disabled", true);

            $.ajax({

                type: "POST",

                enctype: 'multipart/form-data',

                url: "/admin/api/upload",

                data: data,

                processData: false,

                contentType: false,

                cache: false,

                timeout: 600000,

                success: function (data) {

                    console.log("SUCCESS : ", data);

                    $("#btnSubmit").prop("disabled", false);

                    $(".alert-success").show();

                    $(".alert-danger").hide();
                    
                    $(".alert-loc-zero-error").hide();
                    
                    $(".alert-date-nonValid-error").hide();
                    
                    $(".alert-url-exist-error").hide();

                },

                error: function (jqXHR, textStatus, errorThrown) {
                    $(".alert-success").hide();
                    $(".alert-danger").hide();
                    
                    
                    if (jqXHR.responseText === "Url already exist") {
                        $(".alert-url-exist-error").show();
                        $(".alert-loc-zero-error").hide();
                        $(".alert-date-nonValid-error").hide();
                    } else if (jqXHR.responseText === "Insert Loc greater than zero!") {
                        $(".alert-loc-zero-error").show();
                         $(".alert-date-nonValid-error").hide();
                         $(".alert-url-exist-error").hide();
                    } else if (jqXHR.responseText === "Insert a valid Last Update") {
                        $(".alert-date-nonValid-error").show();
                        $(".alert-url-exist-error").hide();
                        $(".alert-loc-zero-error").hide();
                    } else {
                        $(".alert-danger").show();
                    }
                    
                    console.log("ERROR : ", jqXHR);
                    $("#btnSubmit").prop("disabled", false);
                }
                
                
            });

        });

    });

</script>
</body>
</html>